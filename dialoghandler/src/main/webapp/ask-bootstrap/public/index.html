<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Dialog logs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Ask Bootstrap: a compilation of frameworks with handy scripts and styles, ready for cooking a new project or web app immediately.">
    <meta name="author"
          content="Compiled and maintained by Cengiz Ulusoy. Refer to 'copyrights' section for licences of the components used in this project.">

    <!-- Le styles -->
    <link href="ask-bootstrap/public/src/css/bootstrap.css" rel="stylesheet">
    <link href="ask-bootstrap/public/src/css/responsive.css" rel="stylesheet">
    <link href="ask-bootstrap/public/src/css/datepicker.css" rel="stylesheet">
    <!-- sticker footer -->
    <style type="text/css">
        html,
        body {
            height: 100%;
            /* The html and body elements cannot have any padding or margin. */
        }

        body {
            /*padding-top: 80px;*/
            padding-bottom: 40px;
        }

            /* Wrapper for page content to push down footer */
        #wrap {
            min-height: 100%;
            height: auto !important;
            height: 100%;
            /* Negative indent footer by it's height */
            margin: 0 auto -60px;
        }

        /* Set the fixed height of the footer here */
        #push,
        #footer {
            height: 20px;
        }

        #footer {
            background-color: #433c2d;
        }

            /* Lastly, apply responsive CSS fixes as necessary */
        @media (max-width: 767px) {
            #footer {
                margin-left: -20px;
                margin-right: -20px;
                padding-left: 20px;
                padding-right: 20px;
            }
        }
    </style>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="shortcut icon" href="ask-bootstrap/public/src/img/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="ask-bootstrap/public/src/img/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
          href="ask-bootstrap/public/src/img/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
          href="ask-bootstrap/public/src/img/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed"
          href="ask-bootstrap/public/src/img/ico/apple-touch-icon-57-precomposed.png">
</head>

<body>

<div id="wrap">
    <div class="row">
        <div class="navbar" style="margin-bottom:0px;padding-left: 35px">
                <img src="ask-bootstrap/public/src/img/logo.png" alt="ASK-Fast" width="100px" style="height: 30px">
        </div>
        <form class="well">
            <div class="container">
<!--                 <div class="row"> -->
<!--                     <div class="span5"> -->
<!--                         <label id="pubKeyLabel" style="min-width: 80px;" class="span1">AccountId*</label> -->
<!--                         <input id="pubKey" type="text" placeholder="Public Key" style="min-width: 300px;" class="span3"> -->
<!--                     </div> -->
<!--                     <div class="span5"> -->
<!--                         <label id="priKeyLabel" style="min-width: 80px;" class="span1">Token*</label> -->
<!--                         <input id="priKey" type="text" placeholder="Private Key" style="min-width: 300px;" -->
<!--                                class="span3"> -->
<!--                     </div> -->
<!--                 </div> -->
                <div class="span9">
                    <!--<div class="accordion" id="accordion2">-->
                        <!-- <div class="accordion-group">
                            <div class="accordion-heading">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2"
                                   href="#collapseOne">
                                    >> Filters
                                </a>
                            </div>
                            <div id="collapseOne" class="accordion-body collapse ">
                                <div class="accordion-inner"> -->
                                    <div class="span2">
                                        <label> Adapter type</label>
                                        <select class="input-small" id="adapterType" name="adapterType">
                                            <option value="null">All</option>
                                            <option value="xmpp">XMPP</option>
                                            <option value="call">Call</option>
                                            <option value="mail">Mail</option>
                                            <option value="sms">SMS</option>
                                        </select>
                                    </div>
                                    <div class="span2">
                                        <label>Min Severity level</label>
                                        <select class="input-small" id="logLevel" name="logLevel">
                                            <option value="null">All</option>
                                            <option value="DEBUG">Debug</option>
                                            <option value="INFO">Info</option>
                                            <option value="WARNING">Warning</option>
                                            <option value="SEVERE">Severe</option>
                                        </select>
                                    </div>

                                    <div class="span2">
                                        <label>Limit</label>
                                        <select class="input-small" id="limit" name="limit">
                                            <option value="10">10</option>
                                            <option value="50" selected>50</option>
                                            <option value="100">100</option>
                                            <option value="250">250</option>
                                        </select>
                                    </div>

                                    <div class="span2">
                                        <label>Logs until</label>

                                        <div class="input-append date" data-date-format="dd-mm-yyyy">
                                            <div class="input-append date" data-date-format="dd-mm-yyyy">
                                                <input width="3px" id="dp1" class="span2" size="16" type="text"
                                                       placeholder="Pick a date..">
                                                <!--<span class="add-on"><i id="dp1Icon" class="icon-th"></i></span>-->
                                            </div>
                                        </div>
                                    </div>
                                <!-- </div>
                            </div>
                        </div> -->
                    <!--</div>-->
                </div>
            </div>
            <div class="row">
                <div class="offset4">
                    <button class="btn btn-primary" id="search" type="button"><i class="icon-white icon-search"></i>
                        Search
                    </button>
                    <button class="btn btn-inverse" id="reset" type="reset"><i class="icon-white icon-repeat"></i>
                        Reset
                    </button>
                </div>
            </div>
            <div align="center" style="text-align: center; visibility: hidden" id="lookUpMessage">
            </div>
        </form>
    </div>
    <!--log contents table-->
    <div class="row" id="logTableDiv" style="visibility: hidden">
        <div class="container">
            <table class="table table-bordered table-striped" id="example-default" style="margin-bottom: 0px">
                <thead id="logTableHeader" style="visibility: hidden; font-weight: bold">
                <tr>
                    <th class="span1">Level</th>
                    <th class="span4">Adapter Id</th>
                    <th class="span2">Adapter Type</th>
                    <th class="span8">Message</th>
                    <th class="span2">Timestamp</th>
                </tr>
                </thead>
                <tbody id="logTableBody">
                </tbody>
            </table>
        </div>
    </div>
    <div id="push"></div>
    <div id="footer">
        <div class="container">
            <p class="muted credit" align="center">&copy; Ask Community Solutions 2013</p>
        </div>
    </div>
</div>


<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="ask-bootstrap/public/src/js/libs/jquery/jquery.js"></script>
<script src="ask-bootstrap/public/src/js/bootstrap-datepicker.js"></script>
<script>
    $(document).ready(function () {
        $('#dp1').datepicker();
        //$('#search').attr('disabled', 'disabled');

        function supports_html5_storage() {
            try {
                return 'localStorage' in window && window['localStorage'] !== null;
            } catch (e) {
                return false;
            }
        }
        //get localstorage values
        if(supports_html5_storage())
        {
            //$('#pubKey').val(localStorage.getItem("pubKey"));
            //$('#priKey').val(localStorage.getItem("priKey"));
            //optional parameters
            $('#adapterType').val(localStorage.getItem("adapterType"));
            $('#logLevel').val(localStorage.getItem("level"));
            $('#limit').val(localStorage.getItem("limit"));
            $('#dp1').val(localStorage.getItem("dp1"));
        }
        //check if public and privatekeys are not empty
        // function checkKeys()
        // {
        //     if ($('#pubKey').val() == '' || $('#priKey').val() == '') {
        //         $('#search').attr('disabled', 'disabled');
        //     }
        //     else{
        //         $('#search').removeAttr('disabled');
        //     }
        // }
        // checkKeys();

        // $('#pubKey').keyup(function () {
        //     checkKeys();
        // });

        // $('#priKey').keyup(function () {
        //     checkKeys();
        // });

        $('#search').click(function () {
            //flush the table
            $('#logTableDiv').css("visibility", "hidden");
            $('#logTableHeader').css("visibility", "hidden");
            $('#logTableBody').html("");

            $('#lookUpMessage').css("visibility", "visible");
            //enable processing icon
            $('#lookUpMessage').html("Looking up...");
            //store the page values in local storage
            if(supports_html5_storage())
            {
                // localStorage.setItem("pubKey", $('#pubKey').val());
                // localStorage.setItem("priKey", $('#priKey').val());
                //optional parameters
                localStorage.setItem("adapterType", $('#adapterType').val());
                localStorage.setItem("level", $('#logLevel').val());
                localStorage.setItem("limit", $('#limit').val());
                localStorage.setItem("dp1", $('#dp1').val());
            }
            //validate if required fields are filled
            // if ($('#priKey').val() == '') {
            //     $('#lookUpMessage').html('<div class="alert" style="text-align: center">' +
            //             '<strong style="color: #e2182d">Error! </strong><strong> Missing private key </strong></div>');
            //     $('#priKey').focus();
            //     $('#priKeyLabel').css("text-emphasis", "red");
            //     return;
            // }
            // if ($('#pubKey').val() == '') {
            //     $('#lookUpMessage').html('<div class="alert" style="text-align: center">' +
            //             '<strong style="color: #e2182d">Error! </strong><strong> Missing public key </strong></div>');
            //     $('#pubKey').focus();
            //     $('#pubKeyLabel').css("text-emphasis", "red");
            //     return;
            // }

            var queryData = '';
            var stringEndDate = $('#dp1').val();
            // queryData += 'bearerToken=';
            // queryData += $.trim($('#priKey').val()) != '' ? $('#priKey').val() : '';
            // queryData += '&accountID=';
            // queryData += $.trim($('#pubKey').val()) != '' ? $('#pubKey').val() : '';
           if ($.trim($('#adapterId').val()) != '') {
               queryData += '&id=' + $.trim($('#adapterId').val());
           }
            if ($('#adapterType').val() != 'null') {
                queryData += '&type=' + $('#adapterType').val();
            }
            if ($('#logLevel').val() != 'null') {
                queryData += '&level=' + $('#logLevel').val();
            }
            if ($.trim(stringEndDate) != '') {
                queryData += '&end=' + ((parseInt(Date.parse(stringEndDate))) + (1000 * 60 * 60 * 24));
            }
            if ($('#limit').val() != 'null') {
                queryData += '&limit=' + $('#limit').val();
            }
            $.ajax({
                url: '../log/',
                type: 'GET',
                data: queryData,
                success: showResult,
                error: showError
            });

            function showError(response) {
                console.log("error" + response);
                $('#logTableDiv').css("visibility", "hidden");
                $('#logTableHeader').css("visibility", "hidden");
                $('#lookUpMessage').html('<div class="alert" style="text-align: center">' +
                        '<strong style="color: #e2182d">Error! </strong><strong>' + response.responseText + '</strong></div>');
            }

            function showResult(response) {
                //hide the process message
                $('#lookUpMessage').css("visibility", "hidden");
                console.log("result" + response.length);

                //enable the table
                if (response.length != 0) {
                    console.log("response: " + response.length);
                    $('#logTableDiv').css("visibility", "visible");
                    $('#logTableHeader').css("visibility", "visible");

                    var rowData = '';
                    for (var logCounter = 0; logCounter < response.length; logCounter++) {
                        var log = response[logCounter];
                        var logLabel = '';
                        if (log['level'] == 'INFO') {
                            logLabel = '<label style="color: #069317;font-weight:bolder">' + log['level'] + '</label>';
                        }
                        else if (log['level'] == 'DDR') {
                            logLabel = '<label style="color: #0f18b8;font-weight:bolder">' + log['level'] + '</label>';
                        }
                        else if (log['level'] == 'DEBUG') {
                            logLabel = '<label style="color: #0f14b3;font-weight:bolder">' + log['level'] + '</label>';
                        }
                        else if (log['level'] == 'WARNING') {
                            logLabel = '<label style="color: #a3a014;font-weight:bolder">' + log['level'] + '</label>';
                        }
                        else if (log['level'] == 'SEVERE') {
                            logLabel = '<label style="color: #db0a1e;font-weight:bolder">' + log['level'] + '</label>';
                        }
                        rowData = rowData + '<tr>' +
                                '<td>' + logLabel + '</td> ' +
                                '<td>' + log['adapterID'] + '</td>' +
                                '<td>' + log['adapterType'] + '</td>' +
                                '<td>' + log['message'] + '</td>' +
                                '<td>' + new Date(log['timestamp']).toUTCString() + '</td></tr>';
                    }
                    //load contents to the table
                    $('#logTableBody').html(rowData);
                }
                else {
                    console.log("no logs fetched");
                    $('#logTableDiv').css("visibility", "hidden");
                    $('#logTableHeader').css("visibility", "hidden");
                    //show message
                    $('#lookUpMessage').css("visibility", "visible");
                    $('#lookUpMessage').html("No logs found!")
                }
            }
        });
    });
</script>
<script src="ask-bootstrap/public/src/js/libs/bootstrap/bootstrap.js"></script>
<script src="ask-bootstrap/public/src/js/libs/vendor/prefixfree.min.js"></script>
</body>
</html>